function noop(){}function assign(e,t){for(const n in t)e[n]=t[n];return e}function run(e){return e()}function blank_object(){return Object.create(null)}function run_all(e){e.forEach(run)}function is_function(e){return"function"==typeof e}function safe_not_equal(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function is_empty(e){return 0===Object.keys(e).length}function subscribe(e,...t){if(null==e)return noop;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function get_store_value(e){let t;return subscribe(e,e=>t=e)(),t}function component_subscribe(e,t,n){e.$$.on_destroy.push(subscribe(t,n))}function create_slot(e,t,n,r){if(e){r=get_slot_context(e,t,n,r);return e[0](r)}}function get_slot_context(e,t,n,r){return e[1]&&r?assign(n.ctx.slice(),e[1](r(t))):n.ctx}function get_slot_changes(e,t,n,r){if(e[2]&&r){var o=e[2](r(n));if(void 0===t.dirty)return o;if("object"!=typeof o)return t.dirty|o;{const i=[];var s=Math.max(t.dirty.length,o.length);for(let e=0;e<s;e+=1)i[e]=t.dirty[e]|o[e];return i}}return t.dirty}function update_slot_base(e,t,n,r,o,s){o&&(s=get_slot_context(t,n,r,s),e.p(s,o))}function get_all_dirty_from_scope(e){if(32<e.ctx.length){const n=[];var t=e.ctx.length/32;for(let e=0;e<t;e++)n[e]=-1;return n}return-1}function exclude_internal_props(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}function append(e,t){e.appendChild(t)}function append_styles(e,t,n){const r=get_root_for_style(e);if(!r.getElementById(t)){const o=element("style");o.id=t,o.textContent=n,append_stylesheet(r,o)}}function get_root_for_style(e){if(!e)return document;var t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function append_stylesheet(e,t){append(e.head||e,t)}function insert(e,t,n){e.insertBefore(t,n||null)}function detach(e){e.parentNode.removeChild(e)}function element(e){return document.createElement(e)}function listen(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function attr(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function children(e){return Array.from(e.childNodes)}function set_style(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}let crossorigin;function is_crossorigin(){if(void 0===crossorigin){crossorigin=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(e){crossorigin=!0}}return crossorigin}function add_resize_listener(e,t){"static"===getComputedStyle(e).position&&(e.style.position="relative");const n=element("iframe");n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),n.setAttribute("aria-hidden","true"),n.tabIndex=-1;const r=is_crossorigin();let o;return r?(n.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",o=listen(window,"message",e=>{e.source===n.contentWindow&&t()})):(n.src="about:blank",n.onload=()=>{o=listen(n.contentWindow,"resize",t)}),append(e,n),()=>{(r||o&&n.contentWindow)&&o(),detach(n)}}function toggle_class(e,t,n){e.classList[n?"add":"remove"](t)}function custom_event(e,t,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,!1,t),r}let current_component;function set_current_component(e){current_component=e}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(e){get_current_component().$$.on_mount.push(e)}function createEventDispatcher(){const o=get_current_component();return(e,t)=>{const n=o.$$.callbacks[e];if(n){const r=custom_event(e,t);n.slice().forEach(e=>{e.call(o,r)})}}}function setContext(e,t){get_current_component().$$.context.set(e,t)}function getContext(e){return get_current_component().$$.context.get(e)}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(e){render_callbacks.push(e)}let flushing=!1;const seen_callbacks=new Set;function flush(){if(!flushing){flushing=!0;do{for(let e=0;e<dirty_components.length;e+=1){var t=dirty_components[e];set_current_component(t),update(t.$$)}for(set_current_component(null),dirty_components.length=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const n=render_callbacks[e];seen_callbacks.has(n)||(seen_callbacks.add(n),n())}}while(render_callbacks.length=0,dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,flushing=!1,seen_callbacks.clear()}}function update(e){var t;null!==e.fragment&&(e.update(),run_all(e.before_update),t=e.dirty,e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(add_render_callback))}const outroing=new Set;let outros;function transition_in(e,t){e&&e.i&&(outroing.delete(e),e.i(t))}function transition_out(e,t,n,r){e&&e.o&&(outroing.has(e)||(outroing.add(e),outros.c.push(()=>{outroing.delete(e),r&&(n&&e.d(1),r())}),e.o(t)))}function mount_component(t,e,n,r){const{fragment:o,on_mount:s,on_destroy:i,after_update:c}=t.$$;o&&o.m(e,n),r||add_render_callback(()=>{var e=s.map(run).filter(is_function);i?i.push(...e):run_all(e),t.$$.on_mount=[]}),c.forEach(add_render_callback)}function destroy_component(e,t){const n=e.$$;null!==n.fragment&&(run_all(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function make_dirty(e,t){-1===e.$$.dirty[0]&&(dirty_components.push(e),schedule_update(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function init(r,e,t,n,o,s,i,c=[-1]){var a=current_component;set_current_component(r);const u=r.$$={fragment:null,ctx:null,props:s,update:noop,not_equal:o,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:blank_object(),dirty:c,skip_bound:!1,root:e.target||a.$$.root};i&&i(u.root);let l=!1;if(u.ctx=t?t(r,e.props||{},(e,t,...n)=>{n=n.length?n[0]:t;return u.ctx&&o(u.ctx[e],u.ctx[e]=n)&&(!u.skip_bound&&u.bound[e]&&u.bound[e](n),l&&make_dirty(r,e)),t}):[],u.update(),l=!0,run_all(u.before_update),u.fragment=!!n&&n(u.ctx),e.target){if(e.hydrate){const d=children(e.target);u.fragment&&u.fragment.l(d),d.forEach(detach)}else u.fragment&&u.fragment.c();e.intro&&transition_in(r.$$.fragment),mount_component(r,e.target,e.anchor,e.customElement),flush()}set_current_component(a)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{var e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const subscriber_queue=[];function writable(r,o=noop){let s;const i=new Set;function c(e){if(safe_not_equal(r,e)&&(r=e,s)){e=!subscriber_queue.length;for(const t of i)t[1](),subscriber_queue.push(t,r);if(e){for(let e=0;e<subscriber_queue.length;e+=2)subscriber_queue[e][0](subscriber_queue[e+1]);subscriber_queue.length=0}}}return{set:c,update:function(e){c(e(r))},subscribe:function(e,t=noop){const n=[e,t];return i.add(n),1===i.size&&(s=o(c)||noop),e(r),()=>{i.delete(n),0===i.size&&(s(),s=null)}}}}let currentObject,objectType="three";const setCurrentObject=e=>currentObject=e,getCurrentObject=function(e){return"three"===objectType?Array.isArray(e)?new currentObject(...e):new currentObject(e):"custom"===objectType?Array.isArray(e)?currentObject(...e):currentObject(e):void 0},setObjectType=e=>objectType=e;let THREE=writable(null);const isFunction=e=>e instanceof Function,isUndefined=e=>void 0===e,isKebabCaseString=e=>-1!==e.indexOf("-"),hasSetMethod=e=>e&&isFunction(e.set),isCamera=e=>e.type&&`${e.type}`.endsWith("Camera"),dispose=e=>{e&&isFunction(e.dispose)&&e.dispose()},rendererDeclaredProps=["args","camera","onTick","ref","scene"],threeDeclaredProps=["args","attach","onTick","ref","useCannon","useEvents"],isForeignProp=e=>t=>!e.some(e=>e===t),isForeignRendererProp=isForeignProp(rendererDeclaredProps),isForeignThreeProp=isForeignProp(threeDeclaredProps),resolvePath=function(e,t,n="-"){const r=Array.isArray(e)?e:e.split(n);return 1===r.length?t[r[0]]:r.reduce((e,t)=>e&&e[t],t)},getObjectAndProp=(e,t)=>{const n=t.split("-");let r=t,o=t,s=e,i=e;return s=i=1===n.length?(r=o=n[0],e):(r=o=n.pop(),t=n.join("-"),resolvePath(t,e)),hasSetMethod(s[r])&&(i=s[r],o="set"),[s,r,i,o]},setObjectProp=(t,e,n)=>{let r=t,o=e;if(isKebabCaseString(o)){let e=o.split("-");if(o=e.pop(),e=e.join("-"),r=resolvePath(e,t),isUndefined(r))return console.warn(`${e} is undefined`)}hasSetMethod(r[o])&&(r=r[o],o="set"),isFunction(r[o])?Array.isArray(n)?r[o](...n):r[o](n):r[o]=n},isOnTickProp=e=>0===e.indexOf("onTick:"),registerOnTickProp=(o,s,i,e,t,n,r)=>{e[s]=!0;var c=s.replace("onTick:","");const[a,u,l,d]=getObjectAndProp(o,c),p=(e,t,n)=>{const r=i()[s];n=isFunction(r)?r(a[u],o,e,t,n):r;isFunction(l[d])?Array.isArray(n)?l[d](...n):l[d](n):l[d]=n};t(()=>(n(p),()=>{delete e[s],r(p)}))},updateFromProps=(e,t,n,r,o,s,i)=>{for(var c in e()){var a;t(c)&&(a=isOnTickProp(c),!n[c]&&a?registerOnTickProp(r,c,e,n,o,s,i):a||setObjectProp(r,c,e()[c]))}},attachMethods={object3D:(e,t)=>(t.add(e),()=>t.remove(e)),meshMaterial:(e,t)=>{const n=t.material;return t.material=e,()=>{t.material===e&&(t.material=n)}},meshGeometry:(e,t)=>{const n=t.geometry;return t.geometry=e,()=>{t.geometry===e&&(t.geometry=n)}},notAttached:(e,t)=>()=>{}},getAttachMethod=(e,t)=>{var n=get_store_value(THREE);return e instanceof n.Object3D&&t instanceof n.Object3D?attachMethods.object3D:e instanceof n.Material&&t instanceof n.Object3D?attachMethods.meshMaterial:e instanceof n.BufferGeometry&&t instanceof n.Object3D?attachMethods.meshGeometry:attachMethods.notAttached};function add_css$1(e){append_styles(e,"svelte-1ev865t",".svelte-three__renderer.svelte-1ev865t{position:relative;width:100%;height:100%}")}function create_fragment$2(n){let r,o,s;const i=n[13].default,c=create_slot(i,n,n[12],null);return{c(){r=element("div"),c&&c.c(),attr(r,"class","svelte-three__renderer svelte-1ev865t"),add_render_callback(()=>n[14].call(r))},m(e,t){insert(e,r,t),c&&c.m(r,null),o=add_resize_listener(r,n[14].bind(r)),n[15](r),s=!0},p(e,t){c&&c.p&&(!s||4096&t[0])&&update_slot_base(c,i,e,e[12],s?get_slot_changes(i,e[12],t,null):get_all_dirty_from_scope(e[12]),null)},i(e){s||(transition_in(c,e),s=!0)},o(e){transition_out(c,e),s=!1},d(e){e&&detach(r),c&&c.d(e),o(),n[15](null)}}}const FPS=60,MSPF=1e3/FPS;function instance$2(e,t,n){let r;component_subscribe(e,THREE,e=>n(20,r=e));let{$$slots:o={},$$scope:s}=t,{args:i=[]}=t,{scene:c=null}=t,{camera:a=null}=t,{currentScene:u=null}=t,{currentCamera:l=null}=t,{onTick:d=null}=t;var p=getCurrentObject(i);const _=p;setContext("three_parent",_),setContext("three_getAttachMethod",getAttachMethod);const h=_;let m,f=0,g=0,b=[],v,$;const y=new r.Frustum,x=new r.Vector2,E=new r.Raycaster,C=new r.Matrix4;h.domElement.style.width="100%",h.domElement.style.height="auto";h.domElement.addEventListener("pointermove",e=>{x.x=e.offsetX/f*2-1,x.y=2*-(e.offsetY/g)+1,l&&E.setFromCamera(x,l)});const k=e=>{e&&b.push(e)},j=t=>{b=b.filter(e=>e!==t)};setContext("three_setNewestScene",e=>n(10,v=e)),setContext("three_setNewestCamera",e=>n(11,$=e)),setContext("three_getCamera",()=>l),setContext("three_getRenderer",()=>h),setContext("three_addAnimationLoop",k),setContext("three_removeAnimationLoop",j),setContext("three_getFrustum",()=>y),setContext("three_getRaycaster",E);let w=0;const P=t=>{const n=t-w;w=t,b.forEach(e=>e(n/MSPF,n,t)),l&&y.setFromProjectionMatrix(C.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse)),d&&d(h,n/MSPF,n,t)||u&&l&&h.render(u,l)},T={};return onMount(()=>(m.appendChild(h.domElement),h.setAnimationLoop(P),()=>{m.removeChild(h.domElement),h.setAnimationLoop(null),dispose(h)})),e.$$set=e=>{n(31,t=assign(assign({},t),exclude_internal_props(e))),"args"in e&&n(5,i=e.args),"scene"in e&&n(6,c=e.scene),"camera"in e&&n(7,a=e.camera),"currentScene"in e&&n(4,u=e.currentScene),"currentCamera"in e&&n(3,l=e.currentCamera),"onTick"in e&&n(8,d=e.onTick),"$$scope"in e&&n(12,s=e.$$scope)},e.$$.update=()=>{1088&e.$$.dirty[0]&&n(4,u=c||v),2176&e.$$.dirty[0]&&n(3,l=a||$),11&e.$$.dirty[0]&&(_.setSize(f,g,!1),l&&(n(3,l.aspect=f/g,l),l.updateProjectionMatrix())),updateFromProps(()=>t,isForeignRendererProp,T,_,onMount,k,j)},t=exclude_internal_props(t),[f,g,m,l,u,i,c,a,d,p,v,$,s,o,function(){f=this.offsetWidth,g=this.offsetHeight,n(0,f),n(1,g)},function(e){binding_callbacks[e?"unshift":"push"](()=>{m=e,n(2,m)})}]}class Renderer extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$2,safe_not_equal,{args:5,scene:6,camera:7,currentScene:4,currentCamera:3,onTick:8,ref:9},add_css$1,[-1,-1])}get ref(){return this.$$.ctx[9]}}const eventsWithSharedListener=["dblclick","wheel","pointerup","pointerdown"],createIntersection=(e,t)=>({current:null,previous:null,update(){this.previous=this.current,this.current=e.intersectObject(t)[0]}}),createPointerState=e=>({current:"outside-object",states:{"outside-object":()=>!e.previous&&!e.current,"entered-object":()=>!e.previous&&e.current,"inside-object":()=>e.previous&&e.current,"left-object":()=>e.previous&&!e.current},update(){for(var e in this.states)if(this.states[e]()){this.current=e;break}}}),createPointermoveEvent=(t,n,r)=>e=>{t.update(),n.update();e={intersection:t.current,originalEvent:e};"entered-object"===n.current?(r("pointerenter",e),r("pointermove",e)):"inside-object"===n.current?r("pointermove",e):"left-object"===n.current&&r("pointerleave",e)},createClickEvent=(t,n)=>e=>{t.update(),t.current?n("click",{intersection:t.current,originalEvent:e}):n("clickoutside",{intersection:t.current,originalEvent:e})},createOtherEvent=(t,n,r)=>e=>{n.update(),n.current&&r(t,{intersection:n.current,originalEvent:e})},attachEvents=({domElement:n,rayCaster:e,dispatch:t,threeObject:r})=>{const o=createIntersection(e,r);r=createPointerState(o);const s=createPointermoveEvent(o,r,t),i=createClickEvent(o,t),c=eventsWithSharedListener.map(e=>({eventName:e,eventListener:createOtherEvent(e,o,t)}));return n.addEventListener("pointermove",s),n.addEventListener("click",i),c.forEach(({eventName:e,eventListener:t})=>{n.addEventListener(e,t)}),()=>{n.removeEventListener("pointermove",s),n.removeEventListener("click",i),c.forEach(({eventName:e,eventListener:t})=>{n.removeEventListener(e,t)})}};function create_fragment$1(e){let n;const r=e[7].default,o=create_slot(r,e,e[6],null);return{c(){o&&o.c()},m(e,t){o&&o.m(e,t),n=!0},p(e,[t]){o&&o.p&&(!n||64&t)&&update_slot_base(o,r,e,e[6],n?get_slot_changes(r,e[6],t,null):get_all_dirty_from_scope(e[6]),null)},i(e){n||(transition_in(o,e),n=!0)},o(e){transition_out(o,e),n=!1},d(e){o&&o.d(e)}}}function instance$1(e,t,n){let{$$slots:r={},$$scope:o}=t;const s=getContext("three_parent"),i=getContext("three_addAnimationLoop"),c=getContext("three_removeAnimationLoop");let{args:a=[]}=t,{onTick:u=null}=t,{useCannon:l=null}=t,{useEvents:d=!1}=t;var p=getCurrentObject(a);let{attach:_=getAttachMethod(p,s)}=t;const h=p;setContext("three_parent",h),h.isScene&&getContext("three_setNewestScene")(h),isCamera(h)&&getContext("three_setNewestCamera")(h);const m=isFunction(u)?(e,t,n)=>u(h,e,t,n):null;if(onMount(()=>{let e;return isFunction(_)?e=_(h,s):setObjectProp(s,_,h),i(m),()=>{isFunction(_)?isFunction(e)&&e(h,s):setObjectProp(s,_,null),c(m),dispose(h)}}),d){const g={domElement:getContext("three_getRenderer")().domElement,rayCaster:getContext("three_getRaycaster"),dispatch:createEventDispatcher(),threeObject:h};onMount(()=>attachEvents(g))}const f={};return e.$$set=e=>{n(14,t=assign(assign({},t),exclude_internal_props(e))),"args"in e&&n(0,a=e.args),"onTick"in e&&n(1,u=e.onTick),"useCannon"in e&&n(2,l=e.useCannon),"useEvents"in e&&n(3,d=e.useEvents),"attach"in e&&n(5,_=e.attach),"$$scope"in e&&n(6,o=e.$$scope)},e.$$.update=()=>{updateFromProps(()=>t,isForeignThreeProp,f,h,onMount,i,c)},t=exclude_internal_props(t),[a,u,l,d,p,_,o,r]}class Three$1 extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$1,safe_not_equal,{args:0,onTick:1,useCannon:2,useEvents:3,ref:4,attach:5})}get ref(){return this.$$.ctx[4]}}function add_css(e){append_styles(e,"svelte-1qpb034",".svelte-three__dom.svelte-1qpb034{position:absolute;top:0;left:0}.svelte-three__dom--auto-hide.svelte-1qpb034{transition:opacity .2s}.svelte-three__dom--hidden.svelte-1qpb034{opacity:0}.svelte-three__dom--disable-pointer-events.svelte-1qpb034{pointer-events:none}")}function create_fragment(e){let n,r;const o=e[5].default,s=create_slot(o,e,e[4],null);return{c(){n=element("div"),s&&s.c(),attr(n,"class","svelte-three__dom svelte-1qpb034"),set_style(n,"transform","translate("+e[1].x+"px, "+e[1].y+"px)"),toggle_class(n,"svelte-three__dom--auto-hide",e[2]),toggle_class(n,"svelte-three__dom--hidden",e[2]&&!e[0]),toggle_class(n,"svelte-three__dom--disable-pointer-events",!e[3])},m(e,t){insert(e,n,t),s&&s.m(n,null),r=!0},p(e,[t]){s&&s.p&&(!r||16&t)&&update_slot_base(s,o,e,e[4],r?get_slot_changes(o,e[4],t,null):get_all_dirty_from_scope(e[4]),null),(!r||2&t)&&set_style(n,"transform","translate("+e[1].x+"px, "+e[1].y+"px)"),4&t&&toggle_class(n,"svelte-three__dom--auto-hide",e[2]),5&t&&toggle_class(n,"svelte-three__dom--hidden",e[2]&&!e[0]),8&t&&toggle_class(n,"svelte-three__dom--disable-pointer-events",!e[3])},i(e){r||(transition_in(s,e),r=!0)},o(e){transition_out(s,e),r=!1},d(e){e&&detach(n),s&&s.d(e)}}}function instance(e,t,n){let r;component_subscribe(e,THREE,e=>n(7,r=e));let{$$slots:o={},$$scope:s}=t,{autoHide:i=!0}=t,{pointerEvents:c=!0}=t,{inview:a=!1}=t,{position:u={x:0,y:0}}=t;const l=getContext("three_parent"),d=getContext("three_getCamera"),p=getContext("three_getRenderer"),_=getContext("three_addAnimationLoop"),h=getContext("three_removeAnimationLoop"),m=getContext("three_getFrustum"),f=createEventDispatcher();let g=new r.Vector3;const b=()=>{g=l.getWorldPosition(g),n(0,a=m().containsPoint(g)),g.project(d()),n(1,u.x=(.5+g.x/2)*p().domElement.width,u),n(1,u.y=(.5-g.y/2)*p().domElement.height,u)};return onMount(()=>(_(b),()=>h(b))),e.$$set=e=>{"autoHide"in e&&n(2,i=e.autoHide),"pointerEvents"in e&&n(3,c=e.pointerEvents),"inview"in e&&n(0,a=e.inview),"position"in e&&n(1,u=e.position),"$$scope"in e&&n(4,s=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty&&(!0===a?f("enterViewport"):f("exitViewport"))},[a,u,i,c,s,o]}class Dom extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{autoHide:2,pointerEvents:3,inview:0,position:1},add_css)}}const linkThree=e=>THREE.set(e),Three=new Proxy({},{get(e,t){return function(...e){return setObjectType("three"),setCurrentObject(get_store_value(THREE)[t]),new("WebGLRenderer"===t?Renderer:Three$1)(...e)}}}),CustomThree=function(t){return function(...e){return setObjectType("custom"),setCurrentObject(t),new Three$1(...e)}};export{CustomThree,Three,Dom as ThreeDom,linkThree};
