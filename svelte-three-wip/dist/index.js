!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Three={})}(this,function(e){"use strict";function f(){}function T(e,t){for(const n in t)e[n]=t[n];return e}function p(e){return e()}function h(){return Object.create(null)}function m(e){e.forEach(p)}function v(e){return"function"==typeof e}function n(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(e,...t){if(null==e)return f;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function o(e){let t;return r(e,e=>t=e)(),t}function M(e,t,n){e.$$.on_destroy.push(r(t,n))}function t(e,t,n,r){if(e){r=s(e,t,n,r);return e[0](r)}}function s(e,t,n,r){return e[1]&&r?T(n.ctx.slice(),e[1](r(t))):n.ctx}function u(e,t,n,r){if(e[2]&&r){var o=e[2](r(n));if(void 0===t.dirty)return o;if("object"!=typeof o)return t.dirty|o;{const s=[];var i=Math.max(t.dirty.length,o.length);for(let e=0;e<i;e+=1)s[e]=t.dirty[e]|o[e];return s}}return t.dirty}function a(e,t,n,r,o,i){o&&(i=s(t,n,r,i),e.p(i,o))}function l(e){if(32<e.ctx.length){const n=[];var t=e.ctx.length/32;for(let e=0;e<t;e++)n[e]=-1;return n}return-1}function O(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}function i(e,t){e.appendChild(t)}function c(e,t,n){const r=function(e){if(!e)return document;var t=e.getRootNode?e.getRootNode():e.ownerDocument;if(t&&t.host)return t;return e.ownerDocument}(e);if(!r.getElementById(t)){const o=g("style");o.id=t,o.textContent=n,t=r,n=o,i(t.head||t,n)}}function d(e,t,n){e.insertBefore(t,n||null)}function $(e){e.parentNode.removeChild(e)}function g(e){return document.createElement(e)}function y(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function _(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function b(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}let x;function w(e,t){"static"===getComputedStyle(e).position&&(e.style.position="relative");const n=g("iframe");n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),n.setAttribute("aria-hidden","true"),n.tabIndex=-1;const r=function(){if(void 0===x){x=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(e){x=!0}}return x}();let o;return r?(n.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",o=y(window,"message",e=>{e.source===n.contentWindow&&t()})):(n.src="about:blank",n.onload=()=>{o=y(n.contentWindow,"resize",t)}),i(e,n),()=>{(r||o&&n.contentWindow)&&o(),$(n)}}function E(e,t,n){e.classList[n?"add":"remove"](t)}let k;function j(e){k=e}function A(){if(!k)throw new Error("Function called outside component initialization");return k}function S(e){A().$$.on_mount.push(e)}function C(){const o=A();return(e,t)=>{const n=o.$$.callbacks[e];if(n){const r=function(e,t,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,!1,t),r}(e,t);n.slice().forEach(e=>{e.call(o,r)})}}}function N(e,t){A().$$.context.set(e,t)}function L(e){return A().$$.context.get(e)}const D=[],R=[],P=[],W=[],q=Promise.resolve();let z=!1;function F(e){P.push(e)}let H=!1;const G=new Set;function V(){if(!H){H=!0;do{for(let e=0;e<D.length;e+=1){var t=D[e];j(t),function(e){{var t;null!==e.fragment&&(e.update(),m(e.before_update),t=e.dirty,e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(F))}}(t.$$)}for(j(null),D.length=0;R.length;)R.pop()();for(let e=0;e<P.length;e+=1){const n=P[e];G.has(n)||(G.add(n),n())}}while(P.length=0,D.length);for(;W.length;)W.pop()();z=!1,H=!1,G.clear()}}const B=new Set;let I;function X(e,t){e&&e.i&&(B.delete(e),e.i(t))}function Y(e,t,n,r){e&&e.o&&(B.has(e)||(B.add(e),I.c.push(()=>{B.delete(e),r&&(n&&e.d(1),r())}),e.o(t)))}function J(e,t){-1===e.$$.dirty[0]&&(D.push(e),z||(z=!0,q.then(V)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function K(r,e,t,n,o,i,s,c=[-1]){var u=k;j(r);const a=r.$$={fragment:null,ctx:null,props:i,update:f,not_equal:o,bound:h(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:h(),dirty:c,skip_bound:!1,root:e.target||u.$$.root};s&&s(a.root);let l=!1;if(a.ctx=t?t(r,e.props||{},(e,t,...n)=>{n=n.length?n[0]:t;return a.ctx&&o(a.ctx[e],a.ctx[e]=n)&&(!a.skip_bound&&a.bound[e]&&a.bound[e](n),l&&J(r,e)),t}):[],a.update(),l=!0,m(a.before_update),a.fragment=!!n&&n(a.ctx),e.target){if(e.hydrate){const d=(n=e.target,Array.from(n.childNodes));a.fragment&&a.fragment.l(d),d.forEach($)}else a.fragment&&a.fragment.c();e.intro&&X(r.$$.fragment),function(t,e,n,r){const{fragment:o,on_mount:i,on_destroy:s,after_update:c}=t.$$;o&&o.m(e,n),r||F(()=>{var e=i.map(p).filter(v);s?s.push(...e):m(e),t.$$.on_mount=[]}),c.forEach(F)}(r,e.target,e.anchor,e.customElement),V()}j(u)}class Q{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(m(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=f}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{var e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&0!==Object.keys(e).length&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const U=[];let Z,ee="three";function te(e){return"three"===ee?Array.isArray(e)?new Z(...e):new Z(e):"custom"===ee?Array.isArray(e)?Z(...e):Z(e):void 0}const ne=e=>Z=e;let re=function(r,o=f){let i;const s=new Set;function c(e){if(n(r,e)&&(r=e,i)){e=!U.length;for(const t of s)t[1](),U.push(t,r);if(e){for(let e=0;e<U.length;e+=2)U[e][0](U[e+1]);U.length=0}}}return{set:c,update:function(e){c(e(r))},subscribe:function(e,t=f){const n=[e,t];return s.add(n),1===s.size&&(i=o(c)||f),e(r),()=>{s.delete(n),0===s.size&&(i(),i=null)}}}}(null);const oe=e=>e instanceof Function,ie=e=>void 0===e,se=e=>-1!==e.indexOf("-"),ce=e=>e&&oe(e.set),ue=e=>{e&&oe(e.dispose)&&e.dispose()};var ae=e=>t=>!e.some(e=>e===t);const le=ae(["args","camera","onTick","ref","scene"]),de=ae(["args","attach","onTick","ref","useCannon","useEvents"]),fe=function(e,t,n="-"){const r=Array.isArray(e)?e:e.split(n);return 1===r.length?t[r[0]]:r.reduce((e,t)=>e&&e[t],t)},pe=(t,e,n)=>{let r=t,o=e;if(se(o)){let e=o.split("-");if(o=e.pop(),e=e.join("-"),r=fe(e,t),ie(r))return console.warn(`${e} is undefined`)}ce(r[o])&&(r=r[o],o="set"),oe(r[o])?Array.isArray(n)?r[o](...n):r[o](n):r[o]=n},he=e=>0===e.indexOf("onTick:"),me=(o,i,s,e,t,n,r)=>{e[i]=!0;var c=i.replace("onTick:","");const[u,a,l,d]=((e,t)=>{const n=t.split("-");let r=t,o=t,i=e,s=e;return i=s=1===n.length?(r=o=n[0],e):(r=o=n.pop(),t=n.join("-"),fe(t,e)),ce(i[r])&&(s=i[r],o="set"),[i,r,s,o]})(o,c),f=(e,t,n)=>{const r=s()[i];n=oe(r)?r(u[a],o,e,t,n):r;oe(l[d])?Array.isArray(n)?l[d](...n):l[d](n):l[d]=n};t(()=>(n(f),()=>{delete e[i],r(f)}))},ve=(e,t,n,r,o,i,s)=>{for(var c in e()){var u;t(c)&&(u=he(c),!n[c]&&u?me(r,c,e,n,o,i,s):u||pe(r,c,e()[c]))}},$e={object3D:(e,t)=>(t.add(e),()=>t.remove(e)),meshMaterial:(e,t)=>{const n=t.material;return t.material=e,()=>{t.material===e&&(t.material=n)}},meshGeometry:(e,t)=>{const n=t.geometry;return t.geometry=e,()=>{t.geometry===e&&(t.geometry=n)}},notAttached:(e,t)=>()=>{}},ge=(e,t)=>{var n=o(re);return e instanceof n.Object3D&&t instanceof n.Object3D?$e.object3D:e instanceof n.Material&&t instanceof n.Object3D?$e.meshMaterial:e instanceof n.BufferGeometry&&t instanceof n.Object3D?$e.meshGeometry:$e.notAttached};function ye(e){c(e,"svelte-1ev865t",".svelte-three__renderer.svelte-1ev865t{position:relative;width:100%;height:100%}")}function _e(n){let r,o,i;const s=n[13].default,c=t(s,n,n[12],null);return{c(){r=g("div"),c&&c.c(),_(r,"class","svelte-three__renderer svelte-1ev865t"),F(()=>n[14].call(r))},m(e,t){d(e,r,t),c&&c.m(r,null),o=w(r,n[14].bind(r)),n[15](r),i=!0},p(e,t){c&&c.p&&(!i||4096&t[0])&&a(c,s,e,e[12],i?u(s,e[12],t,null):l(e[12]),null)},i(e){i||(X(c,e),i=!0)},o(e){Y(c,e),i=!1},d(e){e&&$(r),c&&c.d(e),o(),n[15](null)}}}function be(e,t,n){let r;M(e,re,e=>n(20,r=e));let{$$slots:o={},$$scope:i}=t,{args:s=[]}=t,{scene:c=null}=t,{camera:u=null}=t,{currentScene:a=null}=t,{currentCamera:l=null}=t,{onTick:d=null}=t;var f=te(s);const p=f;N("three_parent",p),N("three_getAttachMethod",ge);const h=p;let m,v=0,$=0,g=[],y,_;const b=new r.Frustum,x=new r.Vector2,w=new r.Raycaster,E=new r.Matrix4;h.domElement.style.width="100%",h.domElement.style.height="auto";h.domElement.addEventListener("pointermove",e=>{x.x=e.offsetX/v*2-1,x.y=2*-(e.offsetY/$)+1,l&&w.setFromCamera(x,l)});const k=e=>{e&&g.push(e)},j=t=>{g=g.filter(e=>e!==t)};N("three_setNewestScene",e=>n(10,y=e)),N("three_setNewestCamera",e=>n(11,_=e)),N("three_getCamera",()=>l),N("three_getRenderer",()=>h),N("three_addAnimationLoop",k),N("three_removeAnimationLoop",j),N("three_getFrustum",()=>b),N("three_getRaycaster",w);let A=0;const C=t=>{const n=t-A;A=t,g.forEach(e=>e(n/(1e3/60),n,t)),l&&b.setFromProjectionMatrix(E.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse)),d&&d(h,n/(1e3/60),n,t)||a&&l&&h.render(a,l)},L={};return S(()=>(m.appendChild(h.domElement),h.setAnimationLoop(C),()=>{m.removeChild(h.domElement),h.setAnimationLoop(null),ue(h)})),e.$$set=e=>{n(31,t=T(T({},t),O(e))),"args"in e&&n(5,s=e.args),"scene"in e&&n(6,c=e.scene),"camera"in e&&n(7,u=e.camera),"currentScene"in e&&n(4,a=e.currentScene),"currentCamera"in e&&n(3,l=e.currentCamera),"onTick"in e&&n(8,d=e.onTick),"$$scope"in e&&n(12,i=e.$$scope)},e.$$.update=()=>{1088&e.$$.dirty[0]&&n(4,a=c||y),2176&e.$$.dirty[0]&&n(3,l=u||_),11&e.$$.dirty[0]&&(p.setSize(v,$,!1),l&&(n(3,l.aspect=v/$,l),l.updateProjectionMatrix())),ve(()=>t,le,L,p,S,k,j)},t=O(t),[v,$,m,l,a,s,c,u,d,f,y,_,i,o,function(){v=this.offsetWidth,$=this.offsetHeight,n(0,v),n(1,$)},function(e){R[e?"unshift":"push"](()=>{m=e,n(2,m)})}]}class xe extends Q{constructor(e){super(),K(this,e,be,_e,n,{args:5,scene:6,camera:7,currentScene:4,currentCamera:3,onTick:8,ref:9},ye,[-1,-1])}get ref(){return this.$$.ctx[9]}}const we=["dblclick","wheel","pointerup","pointerdown"],Ee=(e,t)=>({current:null,previous:null,update(){this.previous=this.current,this.current=e.intersectObject(t)[0]}}),ke=e=>({current:"outside-object",states:{"outside-object":()=>!e.previous&&!e.current,"entered-object":()=>!e.previous&&e.current,"inside-object":()=>e.previous&&e.current,"left-object":()=>e.previous&&!e.current},update(){for(var e in this.states)if(this.states[e]()){this.current=e;break}}}),je=(t,n,r)=>e=>{t.update(),n.update();e={intersection:t.current,originalEvent:e};"entered-object"===n.current?(r("pointerenter",e),r("pointermove",e)):"inside-object"===n.current?r("pointermove",e):"left-object"===n.current&&r("pointerleave",e)},Ae=(t,n)=>e=>{t.update(),t.current?n("click",{intersection:t.current,originalEvent:e}):n("clickoutside",{intersection:t.current,originalEvent:e})},Ce=(t,n,r)=>e=>{n.update(),n.current&&r(t,{intersection:n.current,originalEvent:e})};function Le(e){let n;const r=e[7].default,o=t(r,e,e[6],null);return{c(){o&&o.c()},m(e,t){o&&o.m(e,t),n=!0},p(e,[t]){o&&o.p&&(!n||64&t)&&a(o,r,e,e[6],n?u(r,e[6],t,null):l(e[6]),null)},i(e){n||(X(o,e),n=!0)},o(e){Y(o,e),n=!1},d(e){o&&o.d(e)}}}function Te(e,t,n){let{$$slots:r={},$$scope:o}=t;const i=L("three_parent"),s=L("three_addAnimationLoop"),c=L("three_removeAnimationLoop");let{args:u=[]}=t,{onTick:a=null}=t,{useCannon:l=null}=t,{useEvents:d=!1}=t;var f,p=te(u);let{attach:h=ge(p,i)}=t;const m=p;N("three_parent",m),m.isScene&&L("three_setNewestScene")(m),(f=m).type&&`${f.type}`.endsWith("Camera")&&L("three_setNewestCamera")(m);const v=oe(a)?(e,t,n)=>a(m,e,t,n):null;if(S(()=>{let e;return oe(h)?e=h(m,i):pe(i,h,m),s(v),()=>{oe(h)?oe(e)&&e(m,i):pe(i,h,null),c(v),ue(m)}}),d){const g={domElement:L("three_getRenderer")().domElement,rayCaster:L("three_getRaycaster"),dispatch:C(),threeObject:m};S(()=>(({domElement:n,rayCaster:e,dispatch:t,threeObject:r})=>{const o=Ee(e,r);r=ke(o);const i=je(o,r,t),s=Ae(o,t),c=we.map(e=>({eventName:e,eventListener:Ce(e,o,t)}));return n.addEventListener("pointermove",i),n.addEventListener("click",s),c.forEach(({eventName:e,eventListener:t})=>{n.addEventListener(e,t)}),()=>{n.removeEventListener("pointermove",i),n.removeEventListener("click",s),c.forEach(({eventName:e,eventListener:t})=>{n.removeEventListener(e,t)})}})(g))}const $={};return e.$$set=e=>{n(14,t=T(T({},t),O(e))),"args"in e&&n(0,u=e.args),"onTick"in e&&n(1,a=e.onTick),"useCannon"in e&&n(2,l=e.useCannon),"useEvents"in e&&n(3,d=e.useEvents),"attach"in e&&n(5,h=e.attach),"$$scope"in e&&n(6,o=e.$$scope)},e.$$.update=()=>{ve(()=>t,de,$,m,S,s,c)},t=O(t),[u,a,l,d,p,h,o,r]}class Me extends Q{constructor(e){super(),K(this,e,Te,Le,n,{args:0,onTick:1,useCannon:2,useEvents:3,ref:4,attach:5})}get ref(){return this.$$.ctx[4]}}function Oe(e){c(e,"svelte-1qpb034",".svelte-three__dom.svelte-1qpb034{position:absolute;top:0;left:0}.svelte-three__dom--auto-hide.svelte-1qpb034{transition:opacity .2s}.svelte-three__dom--hidden.svelte-1qpb034{opacity:0}.svelte-three__dom--disable-pointer-events.svelte-1qpb034{pointer-events:none}")}function Se(e){let n,r;const o=e[5].default,i=t(o,e,e[4],null);return{c(){n=g("div"),i&&i.c(),_(n,"class","svelte-three__dom svelte-1qpb034"),b(n,"transform","translate("+e[1].x+"px, "+e[1].y+"px)"),E(n,"svelte-three__dom--auto-hide",e[2]),E(n,"svelte-three__dom--hidden",e[2]&&!e[0]),E(n,"svelte-three__dom--disable-pointer-events",!e[3])},m(e,t){d(e,n,t),i&&i.m(n,null),r=!0},p(e,[t]){i&&i.p&&(!r||16&t)&&a(i,o,e,e[4],r?u(o,e[4],t,null):l(e[4]),null),(!r||2&t)&&b(n,"transform","translate("+e[1].x+"px, "+e[1].y+"px)"),4&t&&E(n,"svelte-three__dom--auto-hide",e[2]),5&t&&E(n,"svelte-three__dom--hidden",e[2]&&!e[0]),8&t&&E(n,"svelte-three__dom--disable-pointer-events",!e[3])},i(e){r||(X(i,e),r=!0)},o(e){Y(i,e),r=!1},d(e){e&&$(n),i&&i.d(e)}}}function Ne(e,t,n){let r;M(e,re,e=>n(7,r=e));let{$$slots:o={},$$scope:i}=t,{autoHide:s=!0}=t,{pointerEvents:c=!0}=t,{inview:u=!1}=t,{position:a={x:0,y:0}}=t;const l=L("three_parent"),d=L("three_getCamera"),f=L("three_getRenderer"),p=L("three_addAnimationLoop"),h=L("three_removeAnimationLoop"),m=L("three_getFrustum"),v=C();let $=new r.Vector3;const g=()=>{$=l.getWorldPosition($),n(0,u=m().containsPoint($)),$.project(d()),n(1,a.x=(.5+$.x/2)*f().domElement.width,a),n(1,a.y=(.5-$.y/2)*f().domElement.height,a)};return S(()=>(p(g),()=>h(g))),e.$$set=e=>{"autoHide"in e&&n(2,s=e.autoHide),"pointerEvents"in e&&n(3,c=e.pointerEvents),"inview"in e&&n(0,u=e.inview),"position"in e&&n(1,a=e.position),"$$scope"in e&&n(4,i=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty&&(!0===u?v("enterViewport"):v("exitViewport"))},[u,a,s,c,i,o]}ae=new Proxy({},{get(e,t){return function(...e){return ee="three",ne(o(re)[t]),new("WebGLRenderer"===t?xe:Me)(...e)}}});e.CustomThree=function(t){return function(...e){return ee="custom",ne(t),new Me(...e)}},e.Three=ae,e.ThreeDom=class extends Q{constructor(e){super(),K(this,e,Ne,Se,n,{autoHide:2,pointerEvents:3,inview:0,position:1},Oe)}},e.linkThree=e=>re.set(e),Object.defineProperty(e,"__esModule",{value:!0})});
